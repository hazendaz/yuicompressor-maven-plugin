<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M19 from src/site/xdoc/ex_aggregation.xml at 2024-09-05 00:44
 | Rendered using Apache Maven Fluido Skin 2.0.0-M10
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M19" />
    <meta name="author" content="David Bernard" />
    <title>yuicompressor-maven-plugin</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M10.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M10.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><a href="./">yuicompressor-maven-plugin</a></h1></div></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-09-05 00:40<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.1.0</li>
        <li class="pull-right"><a href="./">changelog/scm</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html">Introduction</a></li>
    <li><a href="index.html#Distribution">Distribution</a></li>
    <li><a href="plugin-info.html">Goals</a></li>
    <li><a href="usage_compress.html">Usage: compress</a></li>
    <li><a href="usage_jslint.html">Usage: jslint</a></li>
   <li class="nav-header">Examples</li>
    <li class="active"><a>Aggregate</a></li>
    <li><a href="ex_gzip.html">Gzip</a></li>
    <li><a href="ex_failOnWarning.html">Fail on warning</a></li>
   <li class="nav-header">Links</li>
    <li><a href="../../yui/yuicompressor">YUI Compressor</a></li>
    <li><a href="https://jslint.com/" class="externalLink">JSLint</a></li>
    <li><a href="links.html">Others...</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://www.pledgie.com/campaigns/13361" class="builtBy"><img class="builtBy" src="http://www.pledgie.com/campaigns/13361.png?skin_name=chrome" /> Click here to lend your support to: yuicompressor-maven-plugin and make a donation at www.pledgie.com !</a>
<a href="http://maven.apache.org" class="builtBy"><img class="builtBy" src="images/logos/maven-feather.png" /> Build with Maven 2</a>
<a href="http://creativecommons.org/licenses/LGPL/2.1/" class="builtBy"><img class="builtBy" src="https://creativecommons.org/images/public/cc-LGPL-a.png" /> CC-GNU LGPL</a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">


 <section><a id="Aggregation"></a>
<h1>Aggregation</h1>

<p>Good practice :
</p>
<ul>

<li>on web, is to download/call one big js file instead of several small files.</li>

<li>in source code organisation is to have unit file (with one &quot;concern&quot;).</li>
</ul>


<p>The major js and css framework/lib provide source code in both version (one big, lot of small), or provide a online tool to generate the big.</p>

<p>The following option allow you to use/store small files into your source and generate the big at build time. The aggregation is done after yuicompression</p>

<section><a id="Basic_sample"></a>
<h2>Basic sample</h2>

<p>To Compress every js and css files and aggregate every js file under ${project.build.directory}/${project.build.finalName}/static/ into all.js :
</p>
<pre class="prettyprint"><code>
&lt;project&gt;
...
  &lt;build&gt;
    &lt;plugins&gt;
...
      &lt;plugin&gt;
        &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;
        &lt;artifactId&gt;yuicompressor-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compress&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;nosuffix&gt;true&lt;/nosuffix&gt;
          &lt;aggregations&gt;
            &lt;aggregation&gt;
              &lt;!-- remove files after aggregation (default: false)
              &lt;removeIncluded&gt;true&lt;/removeIncluded&gt;
              --&gt;
              &lt;!-- insert new line after each concatenation (default: false) --&gt;
              &lt;insertNewLine&gt;true&lt;/insertNewLine&gt;
              &lt;output&gt;${project.build.directory}/${project.build.finalName}/static/all.js&lt;/output&gt;
              &lt;!-- files to include, path relative to output's directory or absolute path--&gt;
              &lt;!--inputDir&gt;base directory for non absolute includes, default to parent dir of output&lt;/inputDir--&gt;
              &lt;includes&gt;
                &lt;include&gt;${basedir}/src/licenses/license.js&lt;/include&gt;
                &lt;include&gt;**/*.js&lt;/include&gt;
              &lt;/includes&gt;
              &lt;!-- files to exclude, path relative to output's directory
              &lt;excludes&gt;
                &lt;exclude&gt;**/*.pack.js&lt;/exclude&gt;
                &lt;exclude&gt;**/compressed.css&lt;/exclude&gt;
              &lt;/excludes&gt;
              --&gt;
            &lt;/aggregation&gt;
          &lt;/aggregations&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
...
    &lt;/plugins&gt;
  &lt;/build&gt;
...
&lt;/project&gt;
 </code></pre>

</section>

<section><a id="Removing_included_files"></a>
<h2>Removing included files</h2>

<p>Using removeIncluded option, remove file, but the war plugin will then add file.
So if you want to remove file after aggregation and don't want war plugin copy them, then you need to use warSourceExcludes :
</p>
<pre class="prettyprint"><code>
&lt;project&gt;
...
  &lt;build&gt;
    &lt;plugins&gt;
...
      &lt;plugin&gt;
        &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;
        &lt;artifactId&gt;yuicompressor-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compress&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;nosuffix&gt;true&lt;/nosuffix&gt;
          &lt;aggregations&gt;
           &lt;aggregation&gt;
              &lt;!-- remove files after aggregation (default: false) --&gt;
              &lt;removeIncluded&gt;true&lt;/removeIncluded&gt;
              &lt;!-- insert new line after each concatenation (default: false) --&gt;
              &lt;insertNewLine&gt;true&lt;/insertNewLine&gt;
              &lt;output&gt;${project.build.directory}/${project.build.finalName}/static/all-2.js&lt;/output&gt;
              &lt;!-- files to include, path relative to output's directory --&gt;
              &lt;includes&gt;
                &lt;include&gt;toAggregateAndRemove/**.js&lt;/include&gt;
              &lt;/includes&gt;
            &lt;/aggregation&gt;
          &lt;/aggregations&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
...
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;warSourceExcludes&gt;**/toAggregateAndRemove/**&lt;/warSourceExcludes&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
...
    &lt;/plugins&gt;
  &lt;/build&gt;
...
&lt;/project&gt;
 </code></pre>

</section>
<section><a id="Adding_header_.28copyright.29"></a>
<h2>Adding header (copyright)</h2>

<p>When aggregating minified js files, the copyright headers have been stripped out which is fine because we don't want to repeat it several times in the output file.
However it would be great to be able to insert one at beginning of output file.
</p>

<p>For simple cases, the maven-license-plugin is enough if you use the same header for all files but it is not enough if you want to have a different header per aggregation (different libraries with different licensing schemes).</p>

<ol style="list-style-type: decimal;">

<li>you put license header in its own file (ex license_js.txt)</li>

<li>aggregate a license header to minified files.</li>
</ol>

<pre class="prettyprint"><code>
  &lt;includes&gt;
    &lt;include&gt;${project.build.sourceDirectory}/../webapp/js/mylib/copyright.txt&lt;/include&gt;
    &lt;include&gt;mylib/**/*.js&lt;/include&gt;
  &lt;/includes&gt;
 </code></pre>

</section>
<section><a id="Adding_filename_headers"></a>
<h2>Adding filename headers</h2>

<p>When aggregating minified js or css files, the file headers have been stripped out.
However it would be great to be able to easily identify the corresponding input files when looking at the aggregated file.
</p>
<pre class="prettyprint"><code>
&lt;project&gt;
...
  &lt;build&gt;
    &lt;plugins&gt;
...
      &lt;plugin&gt;
        &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;
        &lt;artifactId&gt;yuicompressor-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compress&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;aggregations&gt;
           &lt;aggregation&gt;
              &lt;!-- insert new line after each concatenation (default: false) --&gt;
              &lt;insertNewLine&gt;true&lt;/insertNewLine&gt;
              &lt;!-- insert file header before each aggregated file (default: false) --&gt;
              &lt;insertFileHeader&gt;true&lt;/insertFileHeader&gt;
              &lt;output&gt;${project.build.directory}/${project.build.finalName}/static/all-3.js&lt;/output&gt;
              &lt;!-- files to include, path relative to output's directory --&gt;
              &lt;includes&gt;
                &lt;include&gt;**/*.js&lt;/include&gt;
              &lt;/includes&gt;
            &lt;/aggregation&gt;
          &lt;/aggregations&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
...
    &lt;/plugins&gt;
  &lt;/build&gt;
...
&lt;/project&gt;
 </code></pre>

</section>
<section><a id="Automatically_exclude_wildcard_matches_that_were_included_in_previous_aggregations"></a>
<h2>Automatically exclude wildcard matches that were included in previous aggregations</h2>

<p>When multiple aggregations are defined for the same type of file, such as css, it can be tedious to maintain matching exclusions on the final aggregation which uses a wildcard inclusion.
It would be convenient to automatically exclude wildcard matches that have been included in previous aggregations.
</p>
<pre class="prettyprint"><code>
&lt;project&gt;
...
  &lt;build&gt;
    &lt;plugins&gt;
...
      &lt;plugin&gt;
        &lt;groupId&gt;net.alchim31.maven&lt;/groupId&gt;
        &lt;artifactId&gt;yuicompressor-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;compress&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;aggregations&gt;
           &lt;aggregation&gt;
              &lt;output&gt;${project.build.directory}/${project.build.finalName}/static/IE.css&lt;/output&gt;
              &lt;!-- files to include, path relative to output's directory --&gt;
              &lt;includes&gt;
                &lt;include&gt;**/IE*.css&lt;/include&gt;
              &lt;/includes&gt;
            &lt;/aggregation&gt;
           &lt;aggregation&gt;
              &lt;!-- exclude any wildcard matches that have been included by prior aggregations (default: false) --&gt;
              &lt;autoExcludeWildcards&gt;true&lt;/autoExcludeWildcards&gt;
              &lt;output&gt;${project.build.directory}/${project.build.finalName}/static/everything-except-IE.css&lt;/output&gt;
              &lt;!-- files to include, path relative to output's directory --&gt;
              &lt;includes&gt;
                &lt;include&gt;**/*.css&lt;/include&gt;
              &lt;/includes&gt;
            &lt;/aggregation&gt;
          &lt;/aggregations&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
...
    &lt;/plugins&gt;
  &lt;/build&gt;
...
&lt;/project&gt;
 </code></pre>

</section>
</section>

        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2012–2024
<a href="https://github.com/hazendaz/">hazendaz</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>